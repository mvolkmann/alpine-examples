<!-- TODO: These styles are NOT scoped to this component! -->
<style>
  .progress-bg {
    height: 2rem;
    position: relative;
    width: 20rem;
  }
  .progress-bar {
    height: 100%;
  }
  .progress-value {
    color: white;
    font-family: sans-serif;
    /* centers text in .progress-bg */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
</style>

<script>
  console.log("progress-bar.html: loaded first script");

  // TODO: Could this script be scoped to this component?
  function ProgressBar() {
    console.log("progress-bar.html ProgressBar: entered");
  }
</script>

<!-- TODO: I don't like that there is so much JS in a string! -->
<div
  class="progress-bg"
  :style="`background-color: ${typeof bgColor === 'undefined' ? 'gray' : bgColor}`"
  x-data="{
    getBarStyle() {
      this.validate();
      const barColor =
        typeof low !== 'undefined' && lowColor && value <= low ? lowColor :
        typeof high !== 'undefined' && highColor && value >= high ? highColor :
        typeof color === 'undefined' ? 'green' : color;
      return `background-color: ${barColor}; width: ${this.getPercent()}%`;
    },
    getPercent() {
      this.validate();
      const minimum = typeof min === 'undefined' ? 0 : min;
      const maximum = typeof max === 'undefined' ? 100 : max;
      return Math.round((value - minimum) / (maximum - minimum) * 100);
    },
    init() {
      ProgressBar();
    },
    validate() {
      if (typeof value === 'undefined') {
        throw new Error('progress-bar requires value');
      }
    }
  }"
>
  <div class="progress-bar" :style="getBarStyle"></div>
  <div class="progress-value" x-text="getPercent"></div>
</div>

<script>
  console.log("progress-bar.html: loaded second script");
</script>
