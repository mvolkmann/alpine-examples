<html>
  <head>
    <link rel="stylesheet" href="todo-list.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <script>
      let lastId = 2;

      document.addEventListener("alpine:init", () => {
        Alpine.store("data", {
          status: "",
          todos: [],
        });
        addTodo("buy milk");
        addTodo("cut grass");
        updateStatus();
      });

      function addTodo(text) {
        console.log("todo-list.html addTodo: text =", text);
        const data = Alpine.store("data");
        data.todos.push(createTodo(text));
        updateStatus();
      }

      // This keeps all the todos that are not done.
      function archiveCompleted() {
        const data = Alpine.store("data");
        data.todos = data.todos.filter((t) => !t.done);
        updateStatus();
      }

      function createTodo(text, done = false) {
        return { id: ++lastId, text, done };
      }

      function deleteTodo(todoId) {
        const data = Alpine.store("data");
        data.todos = data.todos.filter((t) => t.id !== todoId);
        updateStatus();
      }

      function updateStatus() {
        const data = Alpine.store("data");
        const { todos } = data;
        const uncompletedCount = todos.filter((t) => !t.done).length;
        data.status = `${uncompletedCount} of ${todos.length} remaining`;
      }
    </script>
  </head>
  <body x-data>
    <h1>To Do List</h1>
    <div>
      <span x-text="$store.data.status"></span>
      <button @click="archiveCompleted">Archive Completed</button>
    </div>
    <form x-data="{text: ''}" @submit.prevent="addTodo(text); text = ''">
      <input placeholder="enter new todo here" size="30" x-model="text" />
      <button :disabled="!text">Add</button>
    </form>
    <ul>
      <template x-for="todo in $store.data.todos">
        <li x-transition>
          <input
            type="checkbox"
            :checked="todo.done"
            @change="todo.done = !todo.done; updateStatus()"
          />
          <span :class="{done: todo.done}" x-text="todo.text"></span>
          <button class="plain" @click="deleteTodo(todo.id)">ðŸ—‘</button>
        </li>
      </template>
    </ul>
  </body>
</html>
